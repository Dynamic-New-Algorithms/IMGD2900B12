(function(){var a,b,c,d;a=0;b=["ms","moz","webkit","o"];for(c=0;c<(b.length&&!window.requestAnimationFrame);c+=1){d=b[c];window.requestAnimationFrame=window[d+"RequestAnimationFrame"];window.cancelAnimationFrame=window[d+"CancelAnimationFrame"]||window[d+"CancelRequestAnimationFrame"];}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(f,h){var g,i,j;g=new Date().getTime();i=Math.max(0,16-(g-a));j=window.setTimeout(function(){f(g+i);},i);a=g+i;return j;};}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(e){window.clearTimeout(e);};}}());var PS={VERSION:"2.3.1",ERROR:"ERROR",DEFAULT:"DEFAULT",CURRENT:"CURRENT",ALL:"ALL",EMPTY:"EMPTY",CANVAS_SIZE:480,MAIN_ID:"mn",STATUS_ID:"sts",CANVAS_ID:"cvs",FOOTER_ID:"ftr",DEBUG_ID:"dbg",MONITOR_ID:"mon",GRID_MAX:32,GRID_DEFAULT_WIDTH:8,GRID_DEFAULT_HEIGHT:8,DEFAULT_BEAD_COLOR:0,DEFAULT_BEAD_RED:0,DEFAULT_BEAD_GREEN:0,DEFAULT_BEAD_BLUE:0,DEFAULT_BG_COLOR:16777215,DEFAULT_BG_RED:255,DEFAULT_BG_GREEN:255,DEFAULT_BG_BLUE:255,DEFAULT_BORDER_COLOR:8421504,DEFAULT_BORDER_RED:128,DEFAULT_BORDER_GREEN:128,DEFAULT_BORDER_BLUE:128,DEFAULT_BORDER_WIDTH:1,DEFAULT_GLYPH_COLOR:16777215,DEFAULT_GLYPH_RED:255,DEFAULT_GLYPH_GREEN:255,DEFAULT_GLYPH_BLUE:255,DEFAULT_FLASH_COLOR:16777215,DEFAULT_FLASH_RED:255,DEFAULT_FLASH_GREEN:255,DEFAULT_FLASH_BLUE:255,DEFAULT_ALPHA:100,DEFAULT_FPS:17,REDSHIFT:256*256,GREENSHIFT:256,FLASH_STEP:10,STATUS_FLASH_STEP:5,FLASH_INTERVAL:5,DEFAULT_TEXT_COLOR:0,AUDIO_PATH_DEFAULT:"http://users.wpi.edu/~bmoriarty/ps/audio/",MAX_VOLUME:1,DEFAULT_VOLUME:0.5,DEFAULT_LOOP:false,AudioCurrentPath:"",AUDIO_MAX_CHANNELS:32,CHANNEL_EMPTY:0,CHANNEL_LOADING:1,CHANNEL_READY:2,CHANNEL_PLAYING:3,CHANNEL_PAUSED:4,AudioChannels:[],AudioContext:null,COLOR_BLACK:0,COLOR_WHITE:16777215,COLOR_GRAY_LIGHT:12632256,COLOR_GRAY:8421504,COLOR_GRAY_DARK:4210752,COLOR_RED:16711680,COLOR_ORANGE:16744448,COLOR_YELLOW:16776960,COLOR_GREEN:65280,COLOR_BLUE:255,COLOR_INDIGO:4194559,COLOR_VIOLET:8388863,COLOR_MAGENTA:16711935,COLOR_CYAN:65535,ARROW_LEFT:37,ARROW_RIGHT:39,ARROW_UP:38,ARROW_DOWN:40,KEYPAD_0:96,KEYPAD_1:97,KEYPAD_2:98,KEYPAD_3:99,KEYPAD_4:100,KEYPAD_5:101,KEYPAD_6:102,KEYPAD_7:103,KEYPAD_8:104,KEYPAD_9:105,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,FORWARD:1,BACKWARD:-1,Grid:null,DebugWindow:null,ImageCanvas:null,BlitCanvas:null,BlitContext:null,LoaderCnt:0,MouseX:-1,MouseY:-1,LastX:-1,LastY:-1,OverCanvas:false,DebugFocus:false,FlashDelay:0,UserDelay:0,UserClock:0,Status:"Perlenspiel",StatusHue:0,StatusRed:0,StatusGreen:0,StatusBlue:0,StatusPhase:0,StatusFading:true};PS.TypeOf=function(b){var a;a=typeof b;if(a==="object"){if(b){if(b instanceof Array){a="array";}}else{a="null";}}return a;};PS.Context=function(){var b,a;a=null;b=document.getElementById(PS.CANVAS_ID);if(b&&b.getContext){a=b.getContext("2d");}return a;};PS.ValidRGB=function(a,b){if(typeof a!=="number"){PS.Oops(b+"rgb parameter not a number");return -1;}a=Math.floor(a);if(a<0){PS.Oops(b+"rgb parameter negative");return -1;}if(a>16777215){PS.Oops(b+"rgb parameter out of range");return -1;}return a;};PS.RGBString=function(f,e,c,d){var h;if(d===undefined){h="rgb("+f+","+e+","+c+")";}else{h="rgba("+f+","+e+","+c+","+d+")";}return h;};PS.UnmakeRGB=function(b){var c,g,d,a,f,e;c="[PS.DecodeRGB] ";if(typeof b!=="number"){return PS.Oops(c+"RGB parameter not a number");}b=Math.floor(b);if(b<0){return PS.Oops(c+"RGB parameter negative");}if(b>16777215){return PS.Oops(c+"RGB parameter out of range");}g=b/PS.REDSHIFT;g=Math.floor(g);f=g*PS.REDSHIFT;d=(b-f)/PS.GREENSHIFT;d=Math.floor(d);e=d*PS.GREENSHIFT;a=b-f-e;return{r:g,g:d,b:a};};PS.ValidColorParams=function(k,j,h,l){var a,i,c,m,e,f,d;a=false;i=PS.TypeOf(j);if(i==="number"){if(h===undefined){if((j<0)||(j>16777215)){PS.Oops(k+"multiplexed rgb value out of range");return null;}j=Math.floor(j);c=j/PS.REDSHIFT;c=Math.floor(c);f=c*PS.REDSHIFT;e=(j-f)/PS.GREENSHIFT;e=Math.floor(e);d=e*PS.GREENSHIFT;m=j-f-d;a=true;}else{c=j;e=h;m=l;if(m===undefined){PS.Oops(k+"b parameter missing in rgb triplet");return null;}}}else{if(i==="object"){c=j.r;if(c===undefined){PS.Oops(k+"r element missing in rgb table");return null;}e=j.g;if(e===undefined){PS.Oops(k+"g element missing in rgb table");return null;}m=j.b;if(m===undefined){PS.Oops(k+"b element missing in rgb table");return null;}}else{if(i==="array"){if(j.length<3){PS.Oops(k+"rgb array length invalid");return null;}c=j[0];e=j[1];m=j[2];}else{PS.Oops(k+"Invalid color parameter");return null;}}}if(!a){if(typeof c!=="number"){PS.Oops(k+"red value is not a number");return null;}c=Math.floor(c);if((c<0)&&(c>255)){PS.Oops(k+"red value out of range ["+c+"]");return null;}if(typeof e!=="number"){PS.Oops(k+"green value is not a number");return null;}e=Math.floor(e);if((e<0)&&(e>255)){PS.Oops(k+"green value out of range ["+e+"]");return null;}if(typeof m!=="number"){PS.Oops(k+"blue value is not a number");return null;}m=Math.floor(m);if((m<0)&&(m>255)){PS.Oops(k+"blue value out of range ["+m+"]");return null;}}return{r:c,g:e,b:m};};PS.Dissolve=function(c,b,a){var d;if((a<=0)||(c===b)){return c;}if(a>=100){return b;}if(c>b){d=c-b;d=(a*d)/100;d=Math.floor(d);return(c-d);}d=b-c;d=(a*d)/100;d=Math.floor(d);return(c+d);};PS.InitBead=function(c,e,d,b){var a;a={};a.left=c;a.right=c+d;a.top=e;a.bottom=e+d;a.size=d;a.visible=true;a.empty=true;a.red=PS.DEFAULT_BEAD_RED;a.green=PS.DEFAULT_BEAD_GREEN;a.blue=PS.DEFAULT_BEAD_BLUE;a.color=PS.RGBString(a.red,a.green,a.blue);a.colorNow=a.color;a.alpha=PS.DEFAULT_ALPHA;a.alphaRed=PS.DEFAULT_BEAD_RED;a.alphaGreen=PS.DEFAULT_BEAD_GREEN;a.alphaBlue=PS.DEFAULT_BEAD_BLUE;a.glyph=0;a.glyphStr="";a.glyphRed=PS.DEFAULT_GLYPH_RED;a.glyphGreen=PS.DEFAULT_GLYPH_GREEN;a.glyphBlue=PS.DEFAULT_GLYPH_BLUE;a.glyphColor=PS.RGBString(PS.DEFAULT_GLYPH_RED,PS.DEFAULT_GLYPH_GREEN,PS.DEFAULT_GLYPH_BLUE);a.flash=true;a.flashPhase=0;a.flashRed=PS.DEFAULT_FLASH_RED;a.flashGreen=PS.DEFAULT_FLASH_GREEN;a.flashBlue=PS.DEFAULT_FLASH_BLUE;a.flashColor=PS.RGBString(PS.DEFAULT_FLASH_RED,PS.DEFAULT_FLASH_GREEN,PS.DEFAULT_FLASH_BLUE);a.borderWidth=PS.DEFAULT_BORDER_WIDTH;a.borderRed=PS.DEFAULT_BORDER_RED;a.borderGreen=PS.DEFAULT_BORDER_GREEN;a.borderBlue=PS.DEFAULT_BORDER_BLUE;a.borderAlpha=PS.DEFAULT_ALPHA;a.borderColor=PS.RGBString(PS.DEFAULT_BORDER_RED,PS.DEFAULT_BORDER_GREEN,PS.DEFAULT_BORDER_BLUE);a.data=0;a.audio=null;a.volume=PS.DEFAULT_VOLUME;a.loop=PS.DEFAULT_LOOP;a.exec=null;a.off=document.createElement("canvas");a.off.width=d;a.off.height=d;a.off.backgroundColor=b;a.offContext=a.off.getContext("2d");a.offContext.font=Math.floor(d/2)+"pt sans-serif";a.offContext.textAlign="center";a.offContext.textBaseline="middle";return a;};PS.DrawBead=function(b){var c,a,g,f,d,e;c=PS.Grid.context;g=0;f=0;d=b.size;a=b.offContext;e=b.borderWidth;if(e>0){a.fillStyle=b.borderColor;a.fillRect(0,0,d,d);g+=e;f+=e;d-=(e+e);}if(b.empty){a.fillStyle=PS.Grid.bgColor;}else{a.fillStyle=b.colorNow;}a.fillRect(g,f,d,d);if(b.glyph>0){a.fillStyle=b.glyphColor;a.fillText(b.glyphStr,PS.Grid.glyphX,PS.Grid.glyphY);}c.drawImage(b.off,b.left,b.top);};PS.BlitBead=function(b,a,h){var c,d,g,f,e;c=PS.BlitContext;d=b.size;g=a*d;f=h*d;e=b.borderWidth;if(e>0){c.fillStyle=b.borderColor;c.fillRect(g,f,d,d);g+=e;f+=e;d-=(e+e);}c.fillStyle=b.colorNow;c.fillRect(g,f,d,d);if(b.glyph>0){c.fillStyle=b.glyphColor;c.fillText(b.glyphStr,PS.Grid.glyphX,PS.Grid.glyphY);}};PS.EraseBead=function(a){var b,c,f,e,d;b=PS.Grid.context;f=a.left;e=a.top;c=a.size;d=a.borderWidth;if(d>0){b.fillStyle=a.borderColor;b.fillRect(f,e,c,c);f+=d;e+=d;c-=(d+d);}b.fillStyle=PS.Grid.bgColor;b.fillRect(f,e,c,c);};PS.InitGrid=function(a,h){var f,e,c,d,b,g;f={};f.context=PS.Context();if(!f.context){return null;}f.x=a;f.y=h;f.count=a*h;if(a>=h){f.beadSize=d=Math.floor(PS.CANVAS_SIZE/a);f.width=d*a;f.height=d*h;f.left=0;}else{f.beadSize=d=Math.floor(PS.CANVAS_SIZE/h);f.width=d*a;f.height=d*h;f.left=Math.floor((PS.CANVAS_SIZE-f.width)/2);}f.top=0;f.right=f.left+f.width;f.bottom=f.top+f.height;f.bgRed=PS.DEFAULT_BG_RED;f.bgGreen=PS.DEFAULT_BG_GREEN;f.bgBlue=PS.DEFAULT_BG_BLUE;f.bgColor=PS.RGBString(f.bgRed,f.bgGreen,f.bgBlue);f.borderRed=PS.DEFAULT_BORDER_RED;f.borderGreen=PS.DEFAULT_BORDER_GREEN;f.borderBlue=PS.DEFAULT_BORDER_BLUE;f.borderColor=PS.RGBString(f.borderRed,f.borderGreen,f.borderBlue);f.borderMax=Math.floor((d-8)/2);f.pointing=-1;f.flash=true;f.flashList=[];f.glyphX=Math.floor(d/2);f.glyphY=Math.floor((d/7)*4);f.beads=[];g=f.top;for(c=0;c<h;c+=1){b=f.left;for(e=0;e<a;e+=1){f.beads.push(PS.InitBead(b,g,d,f.bgColor));b+=d;}g+=d;}return f;};PS.DrawGrid=function(){var b,d,c,a;b=PS.Grid.beads;d=PS.Grid.count;for(c=0;c<d;c+=1){a=b[c];if(a.visible){PS.DrawBead(a);}else{PS.EraseBead(a);}}};PS.CheckX=function(a,b){if(typeof a!=="number"){PS.Oops(b+"x parameter not a number");return false;}a=Math.floor(a);if(a<0){PS.Oops(b+"x parameter negative");return false;}if(a>=PS.Grid.x){PS.Oops(b+"x parameter exceeds grid width");return false;}return true;};PS.CheckY=function(b,a){if(typeof b!=="number"){PS.Oops(a+"y parameter not a number");return false;}b=Math.floor(b);if(b<0){PS.Oops(a+"y parameter negative");return false;}if(b>=PS.Grid.y){PS.Oops(a+"y parameter exceeds grid height");return false;}return true;};PS.GridSize=function(a,g){var f,e,d,c,b;f="[PS.GridSize] ";if(typeof a!=="number"){return PS.Oops(f+"Width param not a number");}if(typeof g!=="number"){return PS.Oops(f+"Height param not a number");}a=Math.floor(a);if(a===PS.DEFAULT){a=PS.GRID_DEFAULT_WIDTH;}else{if(a<1){PS.Oops(f+"Width parameter < 1");a=1;}else{if(a>PS.GRID_MAX){PS.Oops(f+"Width parameter > "+PS.GRID_MAX);a=PS.GRID_MAX;}}}g=Math.floor(g);if(g===PS.DEFAULT){g=PS.GRID_DEFAULT_HEIGHT;}else{if(g<1){PS.Oops(f+"Height parameter < 1");g=1;}else{if(g>PS.GRID_MAX){PS.Oops(f+"Height parameter > "+PS.GRID_MAX);g=PS.GRID_MAX;}}}if(PS.Grid){c=PS.Grid.beads;if(c){d=PS.Grid.count;for(e=0;e<d;e+=1){c[e]=null;}}PS.Grid.beads=null;PS.Grid.flashList=null;PS.Grid=null;}PS.Grid=PS.InitGrid(a,g);if(!PS.Grid){return PS.Oops(f+"Grid initialization failed");}PS.MouseX=-1;PS.MouseY=-1;PS.LastX=-1;PS.LastY=-1;if(PS.Grid){b=document.getElementById(PS.CANVAS_ID);if(b){b.height=PS.Grid.height;PS.DrawGrid();}}return true;};PS.GridBGColor=function(j,f,l){var k,i,a,c,d,m,h;k="[PS.GridBGColor] ";i=(PS.Grid.bgRed*PS.REDSHIFT)+(PS.Grid.bgGreen*256)+PS.Grid.bgBlue;if((j===undefined)||(j===PS.CURRENT)){return i;}if(j===PS.DEFAULT){j=PS.DEFAULT_BG_COLOR;c=PS.DEFAULT_BG_RED;d=PS.DEFAULT_BG_GREEN;m=PS.DEFAULT_BG_BLUE;}else{a=PS.ValidColorParams(k,j,f,l);if(!a){return PS.ERROR;}c=a.r;d=a.g;m=a.b;}PS.Grid.bgRed=c;PS.Grid.bgGreen=d;PS.Grid.bgBlue=m;PS.Grid.bgColor=PS.RGBString(c,d,m);h=document.body;h.style.backgroundColor=PS.Grid.bgColor;h=document.getElementById(PS.STATUS_ID);if(h){h.style.backgroundColor=PS.Grid.bgColor;}h=document.getElementById(PS.CANVAS_ID);if(h){h.width=PS.CANVAS_SIZE;PS.DrawGrid();}return j;};PS.MakeRGB=function(f,e,a){var d,c;d="[PS.MakeRGB] ";if(typeof f!=="number"){return PS.Oops(d+"R parameter not a number");}f=Math.floor(f);if(f<0){f=0;}else{if(f>255){f=255;}}if(typeof e!=="number"){return PS.Oops(d+"G parameter not a number");}e=Math.floor(e);if(e<0){e=0;}else{if(e>255){e=255;}}if(typeof a!=="number"){return PS.Oops(d+"B parameter not a number");}a=Math.floor(a);if(a<0){a=0;}else{if(a>255){a=255;}}c=(f*PS.REDSHIFT)+(e*PS.GREENSHIFT)+a;return c;};PS.DoBeadShow=function(b,e,c){var d,a;d=b+(e*PS.Grid.x);a=PS.Grid.beads[d];if((c===undefined)||(c===PS.CURRENT)||(c===a.visible)){return a.visible;}a.visible=c;if(c){if(PS.Grid.flash&&a.flash){PS.FlashStart(b,e);}else{a.colorNow=a.color;PS.DrawBead(a);}}else{PS.EraseBead(a);}return c;};PS.BeadShow=function(a,f,b){var e,d,c;e="[PS.BeadShow] ";if((b!==undefined)&&(b!==PS.CURRENT)){if((b===PS.DEFAULT)||b){b=true;}else{b=false;}}if(a===PS.ALL){if(f===PS.ALL){for(c=0;c<PS.Grid.y;c+=1){for(d=0;d<PS.Grid.x;d+=1){b=PS.DoBeadShow(d,c,b);}}}else{if(!PS.CheckY(f,e)){b=PS.ERROR;}else{for(d=0;d<PS.Grid.x;d+=1){b=PS.DoBeadShow(d,f,b);}}}}else{if(f===PS.ALL){if(!PS.CheckX(a,e)){return PS.ERROR;}for(c=0;c<PS.Grid.y;c+=1){b=PS.DoBeadShow(a,c,b);}}else{if(!PS.CheckX(a,e)||!PS.CheckY(f,e)){b=PS.ERROR;}else{b=PS.DoBeadShow(a,f,b);}}}return b;};PS.DoBeadColor=function(d,k,e,j,h,c){var f,a;f=d+(k*PS.Grid.x);a=PS.Grid.beads[f];if((e===undefined)||(e===PS.CURRENT)){if(a.empty){return PS.EMPTY;}return(a.red*PS.REDSHIFT)+(a.green*256)+a.blue;}if(e===PS.EMPTY){a.empty=true;}else{a.empty=false;a.red=j;a.green=h;a.blue=c;if(a.alpha<PS.DEFAULT_ALPHA){a.alphaRed=PS.Dissolve(PS.Grid.bgRed,j,a.alpha);a.alphaGreen=PS.Dissolve(PS.Grid.bgGreen,h,a.alpha);a.alphaBlue=PS.Dissolve(PS.Grid.bgBlue,c,a.alpha);a.color=PS.RGBString(a.alphaRed,a.alphaGreen,a.alphaBlue);}else{a.alphaRed=j;a.alphaGreen=h;a.alphaBlue=c;a.color=PS.RGBString(j,h,c);}}if(a.visible){if(PS.Grid.flash&&a.flash){PS.FlashStart(d,k);}else{a.colorNow=a.color;PS.DrawBead(a);}}return e;};PS.BeadColor=function(o,l,k,h,n){var m,a,c,d,p,f,e;m="[PS.BeadColor] ";if((k===PS.DEFAULT)||(k===PS.EMPTY)){k=PS.EMPTY;c=d=p=undefined;}else{if((k!==undefined)&&(k!==PS.CURRENT)){a=PS.ValidColorParams(m,k,h,n);if(!a){return PS.ERROR;}c=a.r;d=a.g;p=a.b;}}if(o===PS.ALL){if(l===PS.ALL){for(e=0;e<PS.Grid.y;e+=1){for(f=0;f<PS.Grid.x;f+=1){k=PS.DoBeadColor(f,e,k,c,d,p);}}}else{if(!PS.CheckY(l,m)){k=PS.ERROR;}else{for(f=0;f<PS.Grid.x;f+=1){k=PS.DoBeadColor(f,l,k,c,d,p);}}}}else{if(l===PS.ALL){if(!PS.CheckX(o,m)){return PS.ERROR;}for(e=0;e<PS.Grid.y;e+=1){k=PS.DoBeadColor(o,e,k,c,d,p);}}else{if(!PS.CheckX(o,m)||!PS.CheckY(l,m)){k=PS.ERROR;}else{k=PS.DoBeadColor(o,l,k,c,d,p);}}}return k;};PS.DoBeadAlpha=function(c,f,d){var e,b;e=c+(f*PS.Grid.x);b=PS.Grid.beads[e];if((d===undefined)||(d===PS.CURRENT)||(d===b.alpha)){return b.alpha;}b.alpha=d;if(b.alpha<PS.DEFAULT_ALPHA){b.alphaRed=PS.Dissolve(PS.Grid.bgRed,b.red,d);b.alphaGreen=PS.Dissolve(PS.Grid.bgGreen,b.green,d);b.alphaBlue=PS.Dissolve(PS.Grid.bgBlue,b.blue,d);b.color=PS.RGBString(b.alphaRed,b.alphaGreen,b.alphaBlue);}else{b.alphaRed=b.red;b.alphaGreen=b.green;b.alphaBlue=b.blue;b.color=PS.RGBString(b.red,b.green,b.blue);}if(b.visible&&!b.empty){if(PS.Grid.flash&&b.flash){PS.FlashStart(c,f);}else{b.colorNow=b.color;PS.DrawBead(b);}}return d;};PS.BeadAlpha=function(b,g,c){var f,e,d;f="[PS.BeadAlpha] ";if(c!==undefined){if(typeof c!=="number"){return PS.Oops(f+"alpha param is not a number");}c=Math.floor(c);if(c===PS.DEFAULT){c=PS.DEFAULT_ALPHA;}else{if(c!==PS.CURRENT){if(c<0){c=0;}else{if(c>PS.DEFAULT_ALPHA){c=PS.DEFAULT_ALPHA;}}}}}if(b===PS.ALL){if(g===PS.ALL){for(d=0;d<PS.Grid.y;d+=1){for(e=0;e<PS.Grid.x;e+=1){c=PS.DoBeadAlpha(e,d,c);}}}else{if(!PS.CheckY(g,f)){c=PS.ERROR;}else{for(e=0;e<PS.Grid.x;e+=1){c=PS.DoBeadAlpha(e,g,c);}}}}else{if(g===PS.ALL){if(!PS.CheckX(b,f)){return PS.ERROR;}for(d=0;d<PS.Grid.y;d+=1){c=PS.DoBeadAlpha(b,d,c);}}else{if(!PS.CheckX(b,f)||!PS.CheckY(g,f)){c=PS.ERROR;}else{c=PS.DoBeadAlpha(b,g,c);}}}return c;};PS.DoBeadBorderWidth=function(b,e,d){var c,a;c=b+(e*PS.Grid.x);a=PS.Grid.beads[c];if((d===undefined)||(d===PS.CURRENT)){return a.borderWidth;}a.borderWidth=d;if(a.visible){PS.DrawBead(a);}return d;};PS.BeadBorderWidth=function(a,f,e){var d,c,b;d="[PS.BeadBorderWidth] ";if(e===PS.DEFAULT){e=PS.DEFAULT_BORDER_WIDTH;}else{if((e!==undefined)&&(e!==PS.CURRENT)){if(typeof e!=="number"){return PS.Oops(d+"width param is not a number");}e=Math.floor(e);if(e<0){e=0;}else{if(e>PS.Grid.borderMax){e=PS.Grid.borderMax;}}}}if(a===PS.ALL){if(f===PS.ALL){for(b=0;b<PS.Grid.y;b+=1){for(c=0;c<PS.Grid.x;c+=1){e=PS.DoBeadBorderWidth(c,b,e);}}}else{if(!PS.CheckY(f,d)){e=PS.ERROR;}else{for(c=0;c<PS.Grid.x;c+=1){e=PS.DoBeadBorderWidth(c,f,e);}}}}else{if(f===PS.ALL){if(!PS.CheckX(a,d)){return PS.ERROR;}for(b=0;b<PS.Grid.y;b+=1){e=PS.DoBeadBorderWidth(a,b,e);}}else{if(!PS.CheckX(a,d)||!PS.CheckY(f,d)){e=PS.ERROR;}else{e=PS.DoBeadBorderWidth(a,f,e);}}}return e;};PS.DoBeadBorderColor=function(d,k,e,j,h,c){var f,a;f=d+(k*PS.Grid.x);a=PS.Grid.beads[f];if((e===undefined)||(e===PS.CURRENT)){return(a.borderRed*PS.REDSHIFT)+(a.borderGreen*256)+a.borderBlue;}a.borderRed=j;a.borderGreen=h;a.borderBlue=c;if(a.borderAlpha<PS.DEFAULT_ALPHA){j=PS.Dissolve(PS.Grid.bgRed,j,a.borderAlpha);h=PS.Dissolve(PS.Grid.bgGreen,h,a.borderAlpha);c=PS.Dissolve(PS.Grid.bgBlue,c,a.borderAlpha);}a.borderColor=PS.RGBString(j,h,c);if(a.visible){PS.DrawBead(a);}return e;};PS.BeadBorderColor=function(o,l,k,h,n){var m,a,c,d,p,f,e;m="[PS.BeadBorderColor] ";if(k===PS.DEFAULT){k=PS.DEFAULT_BORDER_COLOR;c=PS.DEFAULT_BORDER_RED;d=PS.DEFAULT_BORDER_GREEN;p=PS.DEFAULT_BORDER_BLUE;}else{if((k!==undefined)&&(k!==PS.CURRENT)){a=PS.ValidColorParams(m,k,h,n);if(!a){return PS.ERROR;}c=a.r;d=a.g;p=a.b;}}if(o===PS.ALL){if(l===PS.ALL){for(e=0;e<PS.Grid.y;e+=1){for(f=0;f<PS.Grid.x;f+=1){k=PS.DoBeadBorderColor(f,e,k,c,d,p);}}}else{if(!PS.CheckY(l,m)){k=PS.ERROR;}else{for(f=0;f<PS.Grid.x;f+=1){k=PS.DoBeadBorderColor(f,l,k,c,d,p);}}}}else{if(l===PS.ALL){if(!PS.CheckX(o,m)){return PS.ERROR;}for(e=0;e<PS.Grid.y;e+=1){k=PS.DoBeadBorderColor(o,e,k,c,d,p);}}else{if(!PS.CheckX(o,m)||!PS.CheckY(l,m)){k=PS.ERROR;}else{k=PS.DoBeadBorderColor(o,l,k,c,d,p);}}}return k;};PS.DoBeadBorderAlpha=function(e,l,f){var h,d,k,j,c;h=e+(l*PS.Grid.x);d=PS.Grid.beads[h];if((f===undefined)||(f===PS.CURRENT)||(f===d.borderAlpha)){return d.borderAlpha;}d.borderAlpha=f;if(f<PS.DEFAULT_ALPHA){k=PS.Dissolve(PS.Grid.bgRed,d.borderRed,f);j=PS.Dissolve(PS.Grid.bgGreen,d.borderGreen,f);c=PS.Dissolve(PS.Grid.bgBlue,d.borderBlue,f);d.borderColor=PS.RGBString(k,j,c);}else{d.borderColor=PS.RGBString(d.borderRed,d.borderGreen,d.borderBlue);}if(d.visible){PS.DrawBead(d);}return f;};PS.BeadBorderAlpha=function(b,g,c){var f,e,d;f="[PS.BeadBorderAlpha] ";if(c!==undefined){if(typeof c!=="number"){return PS.Oops(f+"alpha param is not a number");}c=Math.floor(c);if(c===PS.DEFAULT){c=PS.DEFAULT_ALPHA;}else{if(c!==PS.CURRENT){if(c<0){c=0;}else{if(c>PS.DEFAULT_ALPHA){c=PS.DEFAULT_ALPHA;}}}}}if(b===PS.ALL){if(g===PS.ALL){for(d=0;d<PS.Grid.y;d+=1){for(e=0;e<PS.Grid.x;e+=1){c=PS.DoBeadBorderAlpha(e,d,c);}}}else{if(!PS.CheckY(g,f)){c=PS.ERROR;}else{for(e=0;e<PS.Grid.x;e+=1){c=PS.DoBeadBorderAlpha(e,g,c);}}}}else{if(g===PS.ALL){if(!PS.CheckX(b,f)){return PS.ERROR;}for(d=0;d<PS.Grid.y;d+=1){c=PS.DoBeadBorderAlpha(b,d,c);}}else{if(!PS.CheckX(b,f)||!PS.CheckY(g,f)){c=PS.ERROR;}else{c=PS.DoBeadBorderAlpha(b,g,c);}}}return c;};PS.DoBeadGlyph=function(b,e,d){var c,a;c=b+(e*PS.Grid.x);a=PS.Grid.beads[c];if((d===undefined)||(d===PS.CURRENT)||(d===a.glyph)){return a.glyph;}a.glyph=d;a.glyphStr=String.fromCharCode(d);if(a.visible){if(PS.Grid.flash&&a.flash){PS.FlashStart(b,e);}else{a.colorNow=a.color;PS.DrawBead(a);}}return d;};PS.BeadGlyph=function(a,h,f){var e,d,c,b;e="[PS.BeadGlyph] ";d=typeof f;if(d!=="undefined"){if(d==="string"){if(f.length<1){return PS.Oops(e+"glyph param is empty string");}f=f.charCodeAt(0);}else{if(d==="number"){f=Math.floor(f);if(f===PS.DEFAULT){f=0;}else{if(f!==PS.CURRENT){if(f<0){f=0;}}}}else{return PS.Oops(e+"glyph param not a string or number");}}}if(a===PS.ALL){if(h===PS.ALL){for(b=0;b<PS.Grid.y;b+=1){for(c=0;c<PS.Grid.x;c+=1){f=PS.DoBeadGlyph(c,b,f);}}}else{if(!PS.CheckY(h,e)){f=PS.ERROR;}else{for(c=0;c<PS.Grid.x;c+=1){f=PS.DoBeadGlyph(c,h,f);}}}}else{if(h===PS.ALL){if(!PS.CheckX(a,e)){return PS.ERROR;}for(b=0;b<PS.Grid.y;b+=1){f=PS.DoBeadGlyph(a,b,f);}}else{if(!PS.CheckX(a,e)||!PS.CheckY(h,e)){f=PS.ERROR;}else{f=PS.DoBeadGlyph(a,h,f);}}}return f;};PS.DoBeadGlyphColor=function(d,k,e,j,h,c){var f,a;f=d+(k*PS.Grid.x);a=PS.Grid.beads[f];if((e===undefined)||(e===PS.CURRENT)){return(a.glyphRed*PS.REDSHIFT)+(a.glyphGreen*256)+a.glyphBlue;}a.glyphRed=j;a.glyphGreen=h;a.glyphBlue=c;if(a.alpha<PS.DEFAULT_ALPHA){j=PS.Dissolve(PS.Grid.bgRed,j,a.alpha);h=PS.Dissolve(PS.Grid.bgGreen,h,a.alpha);c=PS.Dissolve(PS.Grid.bgBlue,c,a.alpha);}a.glyphColor=PS.RGBString(j,h,c);if(a.visible&&(a.glyph>0)){PS.DrawBead(a);}return e;};PS.BeadGlyphColor=function(o,l,k,h,n){var m,a,c,d,p,f,e;m="[PS.BeadGlyphColor] ";if(k===PS.DEFAULT){k=PS.DEFAULT_GLYPH_COLOR;c=PS.DEFAULT_GLYPH_RED;d=PS.DEFAULT_GLYPH_GREEN;p=PS.DEFAULT_GLYPH_BLUE;}else{if((k!==undefined)&&(k!==PS.CURRENT)){a=PS.ValidColorParams(m,k,h,n);if(!a){return PS.ERROR;}c=a.r;d=a.g;p=a.b;}}if(o===PS.ALL){if(l===PS.ALL){for(e=0;e<PS.Grid.y;e+=1){for(f=0;f<PS.Grid.x;f+=1){k=PS.DoBeadGlyphColor(f,e,k,c,d,p);}}}else{if(!PS.CheckY(l,m)){k=PS.ERROR;}else{for(f=0;f<PS.Grid.x;f+=1){k=PS.DoBeadGlyphColor(f,l,k,c,d,p);}}}}else{if(l===PS.ALL){if(!PS.CheckX(o,m)){return PS.ERROR;}for(e=0;e<PS.Grid.y;e+=1){k=PS.DoBeadGlyphColor(o,e,k,c,d,p);}}else{if(!PS.CheckX(o,m)||!PS.CheckY(l,m)){k=PS.ERROR;}else{k=PS.DoBeadGlyphColor(o,l,k,c,d,p);}}}return k;};PS.DoBeadFlash=function(b,e,c){var d,a;d=b+(e*PS.Grid.x);a=PS.Grid.beads[d];if((c===undefined)||(c===PS.CURRENT)){return a.flash;}a.flash=c;return c;};PS.BeadFlash=function(a,f,b){var e,d,c;e="[PS.BeadFlash] ";if((b!==undefined)&&(b!==PS.CURRENT)){if(b===PS.DEFAULT){b=true;}else{if(b){b=true;}else{b=false;}}}if(a===PS.ALL){if(f===PS.ALL){for(c=0;c<PS.Grid.y;c+=1){for(d=0;d<PS.Grid.x;d+=1){b=PS.DoBeadFlash(d,c,b);}}}else{if(!PS.CheckY(f,e)){b=PS.ERROR;}else{for(d=0;d<PS.Grid.x;d+=1){b=PS.DoBeadFlash(d,f,b);}}}}else{if(f===PS.ALL){if(!PS.CheckX(a,e)){return PS.ERROR;}for(c=0;c<PS.Grid.y;c+=1){b=PS.DoBeadFlash(a,c,b);}}else{if(!PS.CheckX(a,e)||!PS.CheckY(f,e)){b=PS.ERROR;}else{b=PS.DoBeadFlash(a,f,b);}}}return b;};PS.DoBeadFlashColor=function(d,k,e,j,h,c){var f,a;f=d+(k*PS.Grid.x);a=PS.Grid.beads[f];if((e===undefined)||(e===PS.CURRENT)){return(a.flashRed*PS.REDSHIFT)+(a.flashGreen*256)+a.flashBlue;}a.flashRed=j;a.flashGreen=h;a.flashBlue=c;a.flashColor=PS.RGBString(j,h,c);return e;};PS.BeadFlashColor=function(o,l,k,h,n){var m,c,d,p,a,f,e;m="[PS.BeadFlashColor] ";if(k===PS.DEFAULT){k=PS.DEFAULT_FLASH_COLOR;c=PS.DEFAULT_FLASH_RED;d=PS.DEFAULT_FLASH_GREEN;p=PS.DEFAULT_FLASH_BLUE;}else{if((k!==undefined)&&(k!==PS.CURRENT)){a=PS.ValidColorParams(m,k,h,n);if(!a){return PS.ERROR;}c=a.r;d=a.g;p=a.b;}}if(o===PS.ALL){if(l===PS.ALL){for(e=0;e<PS.Grid.y;e+=1){for(f=0;f<PS.Grid.x;f+=1){k=PS.DoBeadFlashColor(f,e,k,c,d,p);}}}else{if(!PS.CheckY(l,m)){k=PS.ERROR;}else{for(f=0;f<PS.Grid.x;f+=1){k=PS.DoBeadFlashColor(f,l,k,c,d,p);}}}}else{if(l===PS.ALL){if(!PS.CheckX(o,m)){return PS.ERROR;}for(e=0;e<PS.Grid.y;e+=1){k=PS.DoBeadFlashColor(o,e,k,c,d,p);}}else{if(!PS.CheckX(o,m)||!PS.CheckY(l,m)){k=PS.ERROR;}else{k=PS.DoBeadFlashColor(o,l,k,c,d,p);}}}return k;};PS.DoBeadData=function(b,e,d){var c,a;c=b+(e*PS.Grid.x);a=PS.Grid.beads[c];if(d!==undefined){a.data=d;}return a.data;};PS.BeadData=function(a,f,e){var d,c,b;d="[PS.BeadData] ";if(a===PS.ALL){if(f===PS.ALL){for(b=0;b<PS.Grid.y;b+=1){for(c=0;c<PS.Grid.x;c+=1){e=PS.DoBeadData(c,b,e);}}}else{if(!PS.CheckY(f,d)){e=PS.ERROR;}else{for(c=0;c<PS.Grid.x;c+=1){e=PS.DoBeadData(c,f,e);}}}}else{if(f===PS.ALL){if(!PS.CheckX(a,d)){return PS.ERROR;}for(b=0;b<PS.Grid.y;b+=1){e=PS.DoBeadData(a,b,e);}}else{if(!PS.CheckX(a,d)||!PS.CheckY(f,d)){e=PS.ERROR;}else{e=PS.DoBeadData(a,f,e);}}}return e;};PS.DoBeadAudio=function(b,f,e,d){var c,a;c=b+(f*PS.Grid.x);a=PS.Grid.beads[c];if((e!==undefined)&&(e!==PS.CURRENT)){a.audio=e;}if((d!==undefined)&&(d!==PS.CURRENT)){a.volume=d;}return a.audio;};PS.BeadAudio=function(a,g,f,e){var d,c,b;d="[PS.BeadAudio] ";if((f!==undefined)&&(f!==PS.CURRENT)){if(f===PS.DEFAULT){f=null;}else{if(typeof f!=="string"){return PS.Oops(d+"Audio param is not a string");}if(f.length<1){f=null;}}}if((e!==undefined)&&(e!==PS.CURRENT)){if(e===PS.DEFAULT){e=PS.DEFAULT_VOLUME;}else{if(typeof e!=="number"){return PS.Oops(d+"Volume param not a number");}if(e<0){e=0;}else{if(e>PS.MAX_VOLUME){e=PS.MAX_VOLUME;}}}}if(a===PS.ALL){if(g===PS.ALL){for(b=0;b<PS.Grid.y;b+=1){for(c=0;c<PS.Grid.x;c+=1){f=PS.DoBeadAudio(c,b,f,e);}}}else{if(!PS.CheckY(g,d)){f=PS.ERROR;}else{for(c=0;c<PS.Grid.x;c+=1){f=PS.DoBeadAudio(c,g,f,e);}}}}else{if(g===PS.ALL){if(!PS.CheckX(a,d)){return PS.ERROR;}for(b=0;b<PS.Grid.y;b+=1){f=PS.DoBeadAudio(a,b,f,e);}}else{if(!PS.CheckX(a,d)||!PS.CheckY(g,d)){f=PS.ERROR;}else{f=PS.DoBeadAudio(a,g,f,e);}}}return f;};PS.DoBeadFunction=function(b,e,c){var d,a;d=b+(e*PS.Grid.x);a=PS.Grid.beads[d];if((c!==undefined)&&(c!==PS.CURRENT)){a.exec=c;}return a.exec;};PS.BeadFunction=function(a,f,b){var e,d,c;e="[PS.BeadFunction] ";if((b!==undefined)||(b!==PS.CURRENT)){if(b===PS.DEFAULT){b=null;}else{if(typeof b!=="function"){return PS.Oops(e+"exec param not a valid function");}}}if(a===PS.ALL){if(f===PS.ALL){for(c=0;c<PS.Grid.y;c+=1){for(d=0;d<PS.Grid.x;d+=1){b=PS.DoBeadFunction(d,c,b);}}}else{if(!PS.CheckY(f,e)){b=PS.ERROR;}else{for(d=0;d<PS.Grid.x;d+=1){b=PS.DoBeadFunction(d,f,b);}}}}else{if(f===PS.ALL){if(!PS.CheckX(a,e)){return PS.ERROR;}for(c=0;c<PS.Grid.y;c+=1){b=PS.DoBeadFunction(a,c,b);}}else{if(!PS.CheckX(a,e)||!PS.CheckY(f,e)){b=PS.ERROR;}else{b=PS.DoBeadFunction(a,f,b);}}}return b;};PS.DoBeadTouch=function(b,d){var c,a;c=b+(d*PS.Grid.x);a=PS.Grid.beads[c];if(typeof a.audio==="string"){PS.AudioPlay(a.audio,a.volume);}if(typeof a.exec==="function"){a.exec(b,d,a.data);}PS.Click(b,d,a.data);};PS.BeadTouch=function(a,e){var d,c,b;d="[PS.BeadTouch] ";if(a===PS.ALL){if(e===PS.ALL){for(b=0;b<PS.Grid.y;b+=1){for(c=0;c<PS.Grid.x;c+=1){PS.DoBeadTouch(c,b);}}}else{if(PS.CheckY(e,d)){for(c=0;c<PS.Grid.x;c+=1){PS.DoBeadTouch(c,e);}}}}else{if(e===PS.ALL){if(!PS.CheckX(a,d)){return;}for(b=0;b<PS.Grid.y;b+=1){PS.DoBeadTouch(a,b);}}else{if(PS.CheckX(a,d)&&PS.CheckY(e,d)){PS.DoBeadTouch(a,e);}}}};PS.StatusText=function(d){var b,a,c;b="[PS.StatusText] ";a=typeof d;if(a!=="undefined"){if(a!=="string"){return PS.Oops(b+"Parameter is not a valid string");}c=document.getElementById(PS.STATUS_ID);if(c){if(PS.StatusFading){c.style.color=PS.Grid.bgColor;PS.StatusPhase=0;}c.value=d;}PS.Status=d;}return PS.Status;};PS.StatusColor=function(b){var c,a,d;c="[PS.StatusColor] ";if((b!==undefined)&&(b!==PS.CURRENT)){if(b===PS.DEFAULT){b=PS.DEFAULT_TEXT_COLOR;}else{b=PS.ValidRGB(b,c);if(b<0){return PS.ERROR;}}a=PS.UnmakeRGB(b);PS.StatusRed=a.r;PS.StatusGreen=a.g;PS.StatusBlue=a.b;PS.StatusHue=PS.RGBString(a.r,a.g,a.b);PS.StatusPhase=100;d=document.getElementById(PS.STATUS_ID);if(d){d.style.color=PS.StatusHue;}d=document.getElementById(PS.FOOTER_ID);if(d){d.style.color=PS.StatusHue;}}return PS.StatusHue;};PS.StatusFade=function(a){var b,c;b="[PS.StatusFade] ";if((a!==undefined)&&(a!==PS.CURRENT)){if(a||(a===PS.DEFAULT)){a=true;}else{a=false;PS.StatusPhase=100;c=document.getElementById(PS.STATUS_ID);if(c){c.style.color=PS.StatusHue;}}PS.StatusFading=a;}return PS.StatusFading;};PS.DebugOpen=function(){var b,a;if(!PS.DebugWindow){b=document.getElementById(PS.DEBUG_ID);b.style.display="inline";a=document.getElementById(PS.MONITOR_ID);if(a){a.value="";}PS.DebugWindow=true;}};PS.DebugClose=function(){var a;if(PS.DebugWindow){a=document.getElementById(PS.DEBUG_ID);a.style.display="none";PS.DebugWindow=false;}};PS.Debug=function(b){var a;if((typeof b!=="string")||(b.length<1)){return;}PS.DebugOpen();a=document.getElementById(PS.MONITOR_ID);if(a){a.value+=b;a.scrollTop=a.scrollHeight;}};PS.DebugClear=function(){var a;a=document.getElementById(PS.FOOTER_ID);if(a){a.innerHTML="Version "+PS.VERSION;}if(PS.DebugWindow){a=document.getElementById(PS.MONITOR_ID);if(a){a.value="";}}};PS.Oops=function(b){var a;if((typeof b!=="string")||(b.length<1)){b="???";}a=document.getElementById(PS.FOOTER_ID);if(a){a.innerHTML=b;}PS.Debug("ERROR: "+b+"\n");PS.AudioPlay("fx_uhoh",PS.DEFAULT,PS.DEFAULT,PS.DEFAULT);return PS.ERROR;};PS.Clock=function(b){var a;a="[PS.Clock] ";if(b!==undefined){if(typeof b!=="number"){return PS.Oops(a+"ticks parameter not a number");}b=Math.floor(b);if(b<1){PS.UserClock=0;}else{if(typeof PS.Tick!=="function"){return PS.Oops(a+"PS.Tick function undefined");}}PS.UserDelay=0;PS.UserClock=b;}return PS.UserClock;};PS.Timer=function(){window.setTimeout(function(){window.requestAnimationFrame(PS.Timer);PS.DoTimer();},PS.DEFAULT_FPS);};PS.DoTimer=function(){var c,d,i,h,a,j;PS.FlashDelay+=1;if(PS.FlashDelay>=PS.FLASH_INTERVAL){PS.FlashDelay=0;PS.FlashNext();if(PS.StatusFading&&(PS.StatusPhase<100)){c=PS.StatusPhase+PS.STATUS_FLASH_STEP;if(c>=100){c=100;d=PS.StatusHue;}else{i=PS.Dissolve(PS.Grid.bgRed,PS.StatusRed,c);h=PS.Dissolve(PS.Grid.bgGreen,PS.StatusGreen,c);a=PS.Dissolve(PS.Grid.bgBlue,PS.StatusBlue,c);d=PS.RGBString(i,h,a);}PS.StatusPhase=c;j=document.getElementById(PS.STATUS_ID);if(j){j.style.color=d;}}}if(PS.UserClock>0){PS.UserDelay+=1;if(PS.UserDelay>=PS.UserClock){PS.UserDelay=0;if(PS.Tick){try{PS.Tick();}catch(f){PS.UserClock=0;PS.Oops("PS.Tick() failed ["+f.message+"]");}}}}};PS.FlashStart=function(c,f){var e,b,d,a;e=c+(f*PS.Grid.x);b=PS.Grid.beads[e];b.flashPhase=0;b.colorNow=b.flashColor;PS.DrawBead(b);a=PS.Grid.flashList.length;for(d=0;d<a;d+=1){if(PS.Grid.flashList[d]===e){return;}}PS.Grid.flashList.push(e);};PS.FlashNext=function(){var d,f,k,c,e,j,h,a;d=PS.Grid.flashList.length;f=0;while(f<d){k=PS.Grid.flashList[f];c=PS.Grid.beads[k];e=c.flashPhase+PS.FLASH_STEP;if(e>=100){c.colorNow=c.color;c.flashPhase=0;PS.Grid.flashList.splice(f,1);d-=1;}else{c.flashPhase=e;j=PS.Dissolve(c.flashRed,c.alphaRed,e);h=PS.Dissolve(c.flashGreen,c.alphaGreen,e);a=PS.Dissolve(c.flashBlue,c.alphaBlue,e);c.colorNow=PS.RGBString(j,h,a);f+=1;}PS.DrawBead(c);}};PS.MouseXY=function(b,a){var h,g,f,d,j,c,e;if(PS.Grid){if(a.x&&a.y){h=a.x;g=a.y;}else{h=a.clientX;g=a.clientY;}h+=(document.body.scrollLeft+document.documentElement.scrollLeft-b.offsetLeft);g+=(document.body.scrollTop+document.documentElement.scrollTop-b.offsetTop);if((h>=PS.Grid.left)&&(h<PS.Grid.right)&&(g>=PS.Grid.top)&&(g<PS.Grid.bottom)){f=PS.Grid.beads;e=0;for(j=0;j<PS.Grid.y;j+=1){d=f[e];if((g>=d.top)&&(g<d.bottom)){for(c=0;c<PS.Grid.x;c+=1){d=f[e];if((h>=d.left)&&(h<d.right)){PS.MouseX=c;PS.MouseY=j;return;}e+=1;}}else{e+=PS.Grid.x;}}}}PS.MouseX=-1;PS.MouseY=-1;};PS.MouseDown=function(d){var a;PS.MouseXY(this,d);if(PS.MouseX>=0){a=PS.Grid.beads[PS.MouseX+(PS.MouseY*PS.Grid.x)];if(a.audio){PS.AudioPlay(a.audio,a.volume);}if(typeof a.exec==="function"){try{a.exec(PS.MouseX,PS.MouseY,a.data);}catch(c){PS.Oops("Bead "+PS.MouseX+", "+PS.MouseY+" function failed ["+c.message+"]");}}if(PS.Click){try{PS.Click(PS.MouseX,PS.MouseY,a.data);}catch(b){PS.Oops("PS.Click() failed ["+b.message+"]");}}}};PS.MouseUp=function(c){var a;if(PS.Grid&&PS.Release){PS.MouseXY(this,c);if(PS.MouseX>=0){a=PS.Grid.beads[PS.MouseX+(PS.MouseY*PS.Grid.x)];try{PS.Release(PS.MouseX,PS.MouseY,a.data);}catch(b){PS.Oops("PS.Release() failed ["+b.message+"]");}}}};PS.MouseMove=function(f){var b,e;PS.OverCanvas=true;PS.MouseXY(this,f);if(PS.MouseX>=0){b=PS.Grid.beads[PS.MouseX+(PS.MouseY*PS.Grid.x)];if((PS.MouseX!==PS.LastX)||(PS.MouseY!==PS.LastY)){if(PS.Leave){if(PS.LastX>=0){e=PS.Grid.beads[PS.LastX+(PS.LastY*PS.Grid.x)];try{PS.Leave(PS.LastX,PS.LastY,e.data);}catch(d){PS.Oops("PS.Leave() failed ["+d.message+"]");}}}if(PS.Enter){try{PS.Enter(PS.MouseX,PS.MouseY,b.data);}catch(c){PS.Oops("PS.Enter() failed ["+c.message+"]");}}PS.LastX=PS.MouseX;PS.LastY=PS.MouseY;}}else{if(PS.LastX>=0){if(PS.Leave){e=PS.Grid.beads[PS.LastX+(PS.LastY*PS.Grid.x)];try{PS.Leave(PS.LastX,PS.LastY,e.data);}catch(a){PS.Oops("PS.Leave() failed ["+a.message+"]");}}PS.LastX=-1;PS.LastY=-1;}}};PS.MouseOut=function(c){var b;PS.OverCanvas=false;PS.MouseBead=-1;if(PS.Grid&&PS.Leave){if(PS.LastBead>=0){b=PS.Grid.beads[PS.LastBead];try{PS.Leave(b.x,b.y,b.data);}catch(a){PS.Oops("PS.Leave() failed ["+a.message+"]");}}}PS.LastBead=-1;};PS.KeyFilter=function(b,a){if((b>=65)&&(b<=90)){if(a){b+=32;}return b;}switch(b){case 188:b=44;break;case 190:b=46;break;case 191:b=47;break;case 222:b=39;break;case 219:b=91;break;case 221:b=93;break;case 220:b=92;break;default:break;}if(a){switch(b){case 96:b=126;break;case 49:b=33;break;case 50:b=64;break;case 51:b=35;break;case 52:b=36;break;case 53:b=37;break;case 54:b=94;break;case 55:b=38;break;case 56:b=42;break;case 57:b=40;break;case 48:b=41;break;case 45:b=95;break;case 61:b=43;break;case 91:b=123;break;case 93:b=125;break;case 92:b=124;break;case 59:b=58;break;case 39:b=34;break;case 44:b=60;break;case 46:b=62;break;case 47:b=63;break;default:break;}}return b;};PS.SysKeyDown=function(c){var a;if(PS.DebugFocus){c.returnValue=true;return true;}if(PS.KeyDown){c.returnValue=false;if(!c.which){a=c.keyCode;}else{a=c.which;}a=PS.KeyFilter(a,c.shiftKey);try{PS.KeyDown(a,c.shiftKey,c.ctrlKey);}catch(b){PS.Oops("PS.KeyDown() failed ["+b.message+"]");}}return false;};PS.SysKeyUp=function(c){var a;if(PS.KeyUp){c.returnValue=false;if(c.which===null){a=c.keyCode;}else{a=c.which;}a=PS.KeyFilter(a,c.shiftKey);try{PS.KeyUp(a,c.shiftKey,c.ctrlKey);}catch(b){PS.Oops("PS.KeyUp() failed ["+b.message+"]");}}return false;};PS.SysWheel=function(b){var c;if(!PS.OverCanvas){b.returnValue=true;return true;}if(PS.Wheel){c=0;if(!b){b=window.event;}if(b.wheelDelta){c=b.wheelDelta/120;if(window.opera){c=-c;}}else{if(b.detail){c=-(b.detail/3);}}if(b.preventDefault){b.preventDefault();}if(c>=PS.FORWARD){c=PS.FORWARD;}else{c=PS.BACKWARD;}try{PS.Wheel(c);}catch(a){PS.Oops("PS.Wheel() failed ["+a.message+"]");}}b.returnValue=false;};PS.DefaultEvent=function(a){a.returnValue=true;};PS.Random=function(b){var a;a="[PS.Random] ";if(typeof b!=="number"){return PS.Oops(a+"Parameter is not a number");}b=Math.floor(b);if(b<2){return 1;}b=Math.random()*b;b=Math.floor(b)+1;return b;};PS.PianoFiles=["a0","bb0","b0","c1","db1","d1","eb1","e1","f1","gb1","g1","ab1","a1","bb1","b1","c2","db2","d2","eb2","e2","f2","gb2","g2","ab2","a2","bb2","b2","c3","db3","d3","eb3","e3","f3","gb3","g3","ab3","a3","bb3","b3","c4","db4","d4","eb4","e4","f4","gb4","g4","ab4","a4","bb4","b4","c5","db5","d5","eb5","e5","f5","gb5","g5","ab5","a5","bb5","b5","c6","db6","d6","eb6","e6","f6","gb6","g6","ab6","a6","bb6","b6","c7","db7","d7","eb7","e7","f7","gb7","g7","ab7","a7","bb7","b7","c8"];PS.Piano=function(d,a){var b,c;b="[PS.Piano] ";if(typeof d!=="number"){return PS.Oops(b+"Parameter is not a number");}d=Math.floor(d);if(d<1){d=1;}else{if(d>88){d=88;}}c="piano_"+PS.PianoFiles[d-1];if(a){c="l_"+c;}return c;};PS.HchordFiles=["a2","bb2","b2","c3","db3","d3","eb3","e3","f3","gb3","g3","ab3","a3","bb3","b3","c4","db4","d4","eb4","e4","f4","gb4","g4","ab4","a4","bb4","b4","c5","db5","d5","eb5","e5","f5","gb5","g5","ab5","a5","bb5","b5","c6","db6","d6","eb6","e6","f6","gb6","g6","ab6","a6","bb6","b6","c7","db7","d7","eb7","e7","f7"];PS.Harpsichord=function(d,a){var b,c;b="[PS.Harpsichord] ";if(typeof d!=="number"){return PS.Oops(b+"Parameter is not a number");}d=Math.floor(d);if(d<1){d=1;}else{if(d>57){d=57;}}c="hchord_"+PS.HchordFiles[d-1];if(a){c="l_"+c;}return c;};PS.XyloFiles=["a4","bb4","b4","c5","db5","d5","eb5","e5","f5","gb5","g5","ab5","a5","bb5","b5","c6","db6","d6","eb6","e6","f6","gb6","g6","ab6","a6","bb6","b6","c7","db7","d7","eb7","e7","f7","gb7","g7","ab7","a7","bb7","b7"];PS.Xylophone=function(c){var a,b;a="[PS.Xylophone] ";if(typeof c!=="number"){return PS.Oops(a+"Parameter is not a number");}c=Math.floor(c);if(c<1){c=1;}else{if(c>39){c=39;}}b="xylo_"+PS.XyloFiles[c-1];return b;};PS.ImageError=function(a){PS.Debug("[PS.ImageLoad] Error loading "+this.src);};PS.LoaderCount=0;PS.LoaderList=[];PS.DoImageLoad=function(){var a,g,f,e,b,j,c,h;a=this.getAttribute("data-id");g=PS.LoaderList.length;f=0;while(f<g){e=PS.LoaderList[f];if(e.id===a){b=e.func;j=e.format;c=e.file;PS.LoaderList.splice(f,1);break;}f+=1;}h=PS.ImageData(this,j);if(h!==PS.ERROR){try{h.id=a;h.file=c;b(h);}catch(d){PS.Oops("[PS.ImageLoad] Load function failed");}}};PS.ImageLoad=function(b,e,f){var c,a,g;c="[PS.ImageLoad] ";if((typeof b!=="string")||(b.length<1)){return PS.Oops(c+"Invalid file parameter");}if(typeof e!=="function"){return PS.Oops(c+"Invalid function parameter");}if((f===PS.DEFAULT)||(f===undefined)){f=3;}else{if(typeof f!=="number"){return PS.Oops(c+"format parameter not a number");}if((f!==1)&&(f!==3)&&(f!==4)){return PS.Oops(c+"format is not 1, 3 or 4");}}g="img"+PS.LoaderCnt;PS.LoaderCnt+=1;PS.LoaderList.push({file:b,id:g,func:e,format:f});try{a=new Image();a.setAttribute("data-id",g);a.onload=PS.DoImageLoad;a.onerror=PS.ImageError;a.src=b;}catch(d){return PS.Oops(c+"Load failed: "+b+" ["+d.message+"]");}return g;};PS.ImageData=function(A,q){var e,k,t,n,l,x,d,s,f,p,o,z,m,u,y;e="[PS.ImageMap] ";k=A.width;if((typeof k!=="number")||(k<0)){return PS.Oops(e+"Image .width invalid");}k=Math.floor(k);t=A.height;if((typeof t!=="number")||(t<0)){return PS.Oops(e+"Image .height invalid");}t=Math.floor(t);try{PS.ImageCanvas.width=k;PS.ImageCanvas.height=t;n=PS.ImageCanvas.getContext("2d");n.drawImage(A,0,0);}catch(c){return PS.Oops(e+"Data extraction failed @ 1 ["+c.message+"]");}try{l=n.getImageData(0,0,k,t);}catch(v){return PS.Oops(e+"Data extraction failed @ 2 ["+v.message+"]");}x={width:l.width,height:l.height};d=l.data;s=d.length;f=[];p=0;if(q===3){f.length=(s/4)*3;o=0;while(p<s){f[o]=d[p];p+=1;o+=1;f[o]=d[p];p+=1;o+=1;f[o]=d[p];p+=2;o+=1;}x.pixelSize=3;}else{if(q===4){f.length=s;while(p<s){f[p]=d[p];p+=1;f[p]=d[p];p+=1;f[p]=d[p];p+=1;z=d[p];f[p]=Math.floor(z/2.55);p+=1;}x.pixelSize=4;}else{f.length=s/4;o=0;while(p<s){m=d[p];p+=1;u=d[p];p+=1;y=d[p];p+=2;f[o]=(m*PS.REDSHIFT)+(u*PS.GREENSHIFT)+y;o+=1;}x.pixelSize=1;}}x.data=f;return x;};PS.ImageBlit=function(q,R,s,m,o,c,d){var D,F,l,J,T,M,V,C,E,u,Y,f,e,B,z,G,H,N,U,W,X,n,v,Q,S,P,O,K,k,I,j,L,p,A;D="[PS.ImageBlit] ";F=PS.Grid.x;l=PS.Grid.y;if(typeof q!=="object"){return PS.Oops(D+"Invalid imgdata parameter");}J=q.width;if(typeof J!=="number"){return PS.Oops(D+"imgdata.width not a number");}J=Math.floor(J);if(J<1){return PS.Oops(D+"imgdata.width < 1");}T=q.height;if(typeof T!=="number"){return PS.Oops(D+"imgdata.height not a number");}T=Math.floor(T);if(T<1){return PS.Oops(D+"imgdata.height < 1");}X=PS.DEFAULT_ALPHA;C=q.pixelSize;if(typeof C!=="number"){return PS.Oops(D+"imgdata.pixelSize not a number");}C=Math.floor(C);if((C!==1)&&(C!==3)&&(C!==4)){return PS.Oops(D+"imgdata.pixelSize is not 1, 3 or 4");}M=J*T*C;V=q.data;if(V.length!==M){return PS.Oops(D+"imgdata.data length invalid ["+q.data.length+"]");}if((R===undefined)||(R===PS.DEFAULT)){R=0;}else{if(typeof R!=="number"){return PS.Oops(D+"xpos parameter not a number");}R=Math.floor(R);if((R>=F)||((R+J)<0)){return true;}}if((s===undefined)||(s===PS.DEFAULT)){s=0;}else{if(typeof s!=="number"){return PS.Oops(D+"ypos parameter not a number");}s=Math.floor(s);if((s>=l)||((s+T)<0)){return true;}}if(m===undefined){o=0;m=0;c=J;d=T;}else{if(typeof m!=="number"){return PS.Oops(D+"left parameter not a number");}m=Math.floor(m);if((m<0)||(m>=J)){return PS.Oops(D+"left parameter outside of image");}if(typeof o!=="number"){return PS.Oops(D+"top parameter not a number");}o=Math.floor(o);if((o<0)||(o>=T)){return PS.Oops(D+"top parameter outside of image");}if(typeof c!=="number"){return PS.Oops(D+"width parameter not a number");}c=Math.floor(c);if(c<1){return true;}if((m+c)>J){return PS.Oops(D+"left + width exceeds image width");}if(typeof d!=="number"){return PS.Oops(D+"height parameter not a number");}d=Math.floor(d);if(d<1){return true;}if((o+d)>T){return PS.Oops(D+"top + height exceeds image height");}}p=F-R;if(c>p){c=p;}A=l-s;if(d>A){d=A;}E=(J*C);z=PS.Grid.beadSize;p=z*c;A=z*d;PS.BlitCanvas.width=p;PS.BlitCanvas.height=A;B=PS.BlitContext;u=(o*E)+(m*C);e=s;for(G=0;G<d;G+=1){Y=u;f=R;for(H=0;H<c;H+=1){if(C===1){n=V[Y];N=n/PS.REDSHIFT;N=Math.floor(N);v=N*PS.REDSHIFT;U=(n-v)/PS.GREENSHIFT;U=Math.floor(U);Q=U*PS.GREENSHIFT;W=n-v-Q;}else{N=V[Y];U=V[Y+1];W=V[Y+2];if(C===4){X=V[Y+3];}}if(X>0){S=f+(e*F);P=PS.Grid.beads[S];P.empty=false;if(X<PS.DEFAULT_ALPHA){P.alphaRed=PS.Dissolve(PS.Grid.bgRed,P.alphaRed,X);P.alphaGreen=PS.Dissolve(PS.Grid.bgGreen,P.alphaGreen,X);P.alphaBlue=PS.Dissolve(PS.Grid.bgBlue,P.alphaBlue,X);P.color="rgb("+P.alphaRed+","+P.alphaGreen+","+P.alphaBlue+")";}else{P.alphaRed=N;P.alphaGreen=U;P.alphaBlue=W;P.color="rgb("+N+","+U+","+W+")";}P.red=N;P.green=U;P.blue=W;O=z;K=H*z;I=G*z;if(P.visible){P.flashPhase=100;P.colorNow=P.color;k=K;j=I;L=P.borderWidth;if(L>0){B.fillStyle=P.borderColor;B.fillRect(K,I,O,O);K+=L;I+=L;O-=(L+L);}B.fillStyle=P.colorNow;B.fillRect(K,I,O,O);if(P.glyph>0){B.fillStyle=P.glyphColor;B.fillText(P.glyphStr,k+PS.Grid.glyphX,j+PS.Grid.glyphY);}}else{B.fillStyle=PS.Grid.bgColor;B.fillRect(K,I,O,O);}}f+=1;Y+=C;}e+=1;u+=E;}PS.Grid.context.drawImage(PS.BlitCanvas,z*R,z*s);return true;};PS.AudioError=function(a){var d,b;d=a.error.code;switch(d){case 1:b="MEDIA_ERR_ABORTED";break;case 2:b="MEDIA_ERR_NETWORK";break;case 3:b="MEDIA_ERR_DECODE";break;case 4:b="MEDIA_ERR_SRC_NOT_SUPPORTED";break;default:b="UNKNOWN";break;}PS.Oops("[HTML5 audio error: "+b+"]\n");};PS.AudioLoaded=function(c){var a,b;a=this.getAttribute("data-channel");b=PS.AudioChannels[a];b.status=PS.CHANNEL_READY;if(b.playNow){b.playNow=false;PS.PlayHTML5Audio(a);}};PS.AudioEnding=function(e){var a,d,c;a=this.getAttribute("data-channel");d=PS.AudioChannels[a];d.status=PS.CHANNEL_READY;c=d.exec;if(c&&(typeof c==="function")){try{d.exec=null;c();}catch(b){PS.Oops("Audio function error ["+b.message+"]");}}};PS.AudioInit=function(){var c,b,a;c="[PS.AudioInit] ";if(!document.createElement("audio").canPlayType){PS.Oops(c+"HTML5 audio not supported");return false;}PS.AudioContext=null;PS.AudioCurrentPath=PS.AUDIO_PATH_DEFAULT;if(!PS.AudioContext){PS.AudioChannels.length=PS.AUDIO_MAX_CHANNELS;for(b=0;b<PS.AUDIO_MAX_CHANNELS;b+=1){a=document.createElement("audio");if(!a){return PS.Oops(c+"Audio element init failed");}a.setAttribute("data-channel",b);a.setAttribute("onerror",PS.AudioError);a.addEventListener("canplaythrough",PS.AudioLoaded);a.addEventListener("ended",PS.AudioEnding);a.setAttribute("preload","auto");document.body.appendChild(a);PS.AudioChannels[b]={id:"",audio:a,volume:PS.DEFAULT_VOLUME,playNow:false,exec:null,status:PS.CHANNEL_EMPTY};}}return true;};PS.AudioPath=function(b){var a;a="[PS.AudioPath] ";if(b===PS.DEFAULT){PS.AudioCurrentPath=b=PS.AUDIO_PATH_DEFAULT;}else{if((typeof b!=="string")||(b.length<1)){b=PS.Oops(a+"path parameter is not a valid string");}else{PS.AudioCurrentPath=b;}}return b;};PS.AudioLoad=function(e,d){var b,c,a;b="[PS.AudioLoad] ";if((typeof e!=="string")||(e.length<1)){return PS.Oops(b+"ID parameter not a valid string");}if(d===undefined){d=PS.AudioCurrentPath;}else{if(d===PS.DEFAULT){d=PS.AUDIO_PATH_DEFAULT;}else{if((typeof d!=="string")||(d.length<1)){return PS.Oops(b+"Path parameter not a valid string");}}}if(!PS.AudioContext){c=d+e+".wav";a=PS.LoadHTML5Audio(c);if(a===PS.ERROR){return a;}return true;}};PS.AudioPlay=function(h,f,e,g){var b,a,d,c;b="[PS.AudioPlay] ";if((f===undefined)||(f===PS.DEFAULT)){f=PS.DEFAULT_VOLUME;}else{if(typeof f!=="number"){return PS.Oops(b+"Volume parameter not a number");}if(f<0){f=0;}else{if(f>PS.MAX_VOLUME){f=PS.MAX_VOLUME;}}}if(e===PS.DEFAULT){e=null;}else{if((e!==undefined)&&(typeof e!=="function")){return PS.Oops(b+"Func parameter not a valid function");}}if(g===undefined){g=PS.AudioCurrentPath;}else{if(g===PS.DEFAULT){g=PS.AUDIO_PATH_DEFAULT;}else{if((typeof g!=="string")||(g.length<1)){return PS.Oops(b+"Path parameter not a valid string");}}}if(!PS.AudioContext){c=g+h+".wav";for(a=0;a<PS.AUDIO_MAX_CHANNELS;a+=1){d=PS.AudioChannels[a];if((d.id===c)&&(d.status===PS.CHANNEL_READY)){return PS.PlayHTML5Audio(a,f,e);}}a=PS.LoadHTML5Audio(c,f,e,true);if(a===PS.ERROR){return a;}return a+1;}};PS.AudioStop=function(d){var a,b;a="[PS.AudioStop] ";if(typeof d!=="number"){return PS.Oops(a+"Parameter is not a number");}d=Math.floor(d);if(!PS.AudioContext){if((d<1)||(d>PS.AUDIO_MAX_CHANNELS)){return PS.Oops(a+"Invalid channel id");}b=PS.AudioChannels[d-1];b.audio.pause();b.audio.currentTime=0;b.status=PS.CHANNEL_READY;return d;}};PS.AudioPause=function(e){var a,d,b;a="[PS.AudioPause] ";if(typeof e!=="number"){return PS.Oops(a+"Parameter is not a number");}e=Math.floor(e);if(!PS.AudioContext){if((e<1)||(e>PS.AUDIO_MAX_CHANNELS)){return PS.Oops(a+"Invalid channel id ["+e+"]");}d=PS.AudioChannels[e-1];b=d.audio;if(b.paused){PS.PlayHTML5Audio(e-1);}else{d.status=PS.CHANNEL_PAUSED;b.pause();}return e;}};PS.LoadHTML5Audio=function(g,f,e,a){var c,d,b;c="[PS.LoadHTML5Audio] ";for(b=0;b<PS.AUDIO_MAX_CHANNELS;b+=1){d=PS.AudioChannels[b];if((d.id===g)&&(d.status===PS.CHANNEL_READY)){d.audio.currentTime=0;if(f!==undefined){d.volume=f;}if(e!==undefined){d.exec=e;}if(a){PS.PlayHTML5Audio(b);}return b;}}for(b=0;b<PS.AUDIO_MAX_CHANNELS;b+=1){d=PS.AudioChannels[b];if(d.status===PS.CHANNEL_EMPTY){d.id=g;d.audio.setAttribute("src",g);d.status=PS.CHANNEL_LOADING;if(f!==undefined){d.volume=f;}if(e!==undefined){d.exec=e;}if(a){d.playNow=true;}d.audio.load();return b;}}for(b=0;b<PS.AUDIO_MAX_CHANNELS;b+=1){d=PS.AudioChannels[b];if(d.status===PS.CHANNEL_READY){d.id=g;d.audio.setAttribute("src",g);d.status=PS.CHANNEL_LOADING;if(f!==undefined){d.volume=f;}if(e!==undefined){d.exec=e;}if(a){d.playNow=true;}d.audio.load();return b;}}return PS.ERROR;};PS.PlayHTML5Audio=function(a,d,c){var b;b=PS.AudioChannels[a];if(d===undefined){d=b.volume;}else{b.volume=d;}b.audio.volume=d;if(c!==undefined){b.exec=c;}b.status=PS.CHANNEL_PLAYING;b.audio.play();return a+1;};PS.Sys=function(){var f,i,a,c,b,h,d;f="[PS.Sys] ";i=f+"Invalid element";a=document.createElement("div");if(!a){window.alert(i);return;}a.id=PS.MAIN_ID;document.body.appendChild(a);b=document.createElement("div");if(!b){window.alert(i);return;}b.id=PS.DEBUG_ID;document.body.appendChild(b);h=document.createElement("input");if(!h){window.alert(i);return;}h.id=PS.STATUS_ID;h.type="text";h.readonly="readonly";h.value=PS.Status;a.appendChild(h);h=document.createElement("canvas");if(!h){window.alert(f+"HTML5 canvas not supported.");return;}h.id=PS.CANVAS_ID;h.width=PS.CANVAS_SIZE;h.height=PS.CANVAS_SIZE;h.addEventListener("mousedown",PS.MouseDown,false);h.addEventListener("mouseup",PS.MouseUp,false);h.addEventListener("mouseout",PS.MouseOut,false);h.addEventListener("mousemove",PS.MouseMove,false);a.appendChild(h);c=document.createElement("p");if(!h){window.alert(i);return;}c.id=PS.FOOTER_ID;c.innerHTML="Loading Perlenspiel";a.appendChild(c);d=document.createElement("textarea");if(!d){window.alert(i);return;}d.id=PS.MONITOR_ID;d.cols=57;d.rows=8;d.wrap="soft";d.readonly="readonly";d.onfocus=function(){PS.DebugFocus=true;};d.onblur=function(){PS.DebugFocus=false;};b.appendChild(d);if(!PS.AudioInit()){return;}PS.AudioLoad("fx_uhoh");if(typeof PS.Init!=="function"){PS.Init=null;PS.Oops(f+"WARNING: PS.Init function undefined");}if(typeof PS.Click!=="function"){PS.Click=null;PS.Oops(f+"WARNING: PS.Click function undefined");}if(typeof PS.Release!=="function"){PS.Release=null;PS.Oops(f+"WARNING: PS.Release function undefined");}if(typeof PS.Enter!=="function"){PS.Enter=null;PS.Oops(f+"WARNING: PS.Enter function undefined");}if(typeof PS.Leave!=="function"){PS.Leave=null;PS.Oops(f+"WARNING: PS.Leave function undefined");}if(typeof PS.KeyDown!=="function"){PS.KeyDown=null;PS.Oops(f+"WARNING: PS.KeyDown function undefined");}if(typeof PS.KeyUp!=="function"){PS.KeyUp=null;PS.Oops(f+"WARNING: PS.KeyUp function undefined");}if(typeof PS.Wheel!=="function"){PS.Wheel=null;PS.Oops(f+"WARNING: PS.Wheel function undefined");}document.onkeydown=PS.SysKeyDown;document.onkeyup=PS.SysKeyUp;if(window.addEventListener){window.addEventListener("DOMMouseScroll",PS.SysWheel,false);window.addEventListener("mousewheel",PS.SysWheel,false);}else{window.onmousewheel=PS.SysWheel;document.onmousewheel=PS.SysWheel;}PS.ImageCanvas=document.createElement("canvas");PS.BlitCanvas=document.createElement("canvas");PS.BlitCanvas.width=PS.CANVAS_SIZE;PS.BlitCanvas.height=PS.CANVAS_SIZE;PS.BlitContext=PS.BlitCanvas.getContext("2d");PS.Timer();c.innerHTML="Version "+PS.VERSION;if(PS.Init){try{PS.Init();}catch(g){PS.Oops("PS.Init() failed ["+g.message+"]");}}else{PS.GridSize(PS.GRID_DEFAULT_WIDTH,PS.GRID_DEFAULT_HEIGHT);}};
